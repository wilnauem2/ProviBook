import{d as e,r as t,c as r,a as n,b as s,e as o,f as a,t as l,n as i,o as u,g as c,u as d,h as g,i as m,w as p,j as v,v as f,k as h,l as y,m as b,F as x,p as w,q as k,s as S,x as D,T as C,y as E,z as I,A as _,B as A,C as M,D as B,E as V,G as T,H as j,I as L,J as z}from"./vendor-vue-aTg9__mV.js";import{i as N,g as P,c as F,a as $,d as O,u as U,b as H}from"./vendor-firebase-BiA2yxOo.js";import{f as R,F as Y,p as K,d as q}from"./vendor-BfUC8jLb.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const G=N({apiKey:{}.VITE_FIREBASE_API_KEY,authDomain:{}.VITE_FIREBASE_AUTH_DOMAIN,projectId:{}.VITE_FIREBASE_PROJECT_ID,storageBucket:{}.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:{}.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:{}.VITE_FIREBASE_APP_ID}),J=P(G);console.log("=== insurerStore.js: Initializing store ==="),console.log("Firestore instance in store:",J?"Available":"Not available");const W=e("insurer",()=>{const e=t([]),n=t(null),s=t({}),o=t(!1),a=t(null),l=t("insurers"),i=r(()=>t=>e.value.find(e=>e.id===t));function u(t){console.log("Setting insurers in store. Count:",t?.length||0),t&&console.log("Sample insurer data:",JSON.stringify(t[0]||{},null,2)),e.value=t||[]}return{insurers:e,selectedInsurer:n,lastInvoices:s,isLoading:o,error:a,getInsurerById:i,debugStoreState:function(){console.log("=== Store State ==="),console.log("Insurers count:",e.value.length),console.log("Selected Insurer:",n.value),console.log("Last Invoices count:",Object.keys(s.value).length),console.log("Is Loading:",o.value),console.log("Error:",a.value),console.log("===================")},testFirestoreConnection:async function(){console.log("Testing Firestore connection...");try{await H(O(J,"test","test"));return console.log("Firestore test query successful"),!0}catch(e){return console.error("Firestore test query failed:",e),a.value=`Firestore connection failed: ${e.message}`,!1}},fetchInsurers:async(e="insurers")=>{console.log(`Fetching insurers from Firestore collection: ${e}...`),o.value=!0;try{const t=P(),r=F(t,e),n=(await $(r)).docs.map(e=>({id:e.id,...e.data()}));u(n),l.value=e,console.log(`Successfully fetched ${n.length} insurers from ${e}.`)}catch(t){console.error(`Error fetching insurers from ${e}:`,t),a.value=t.message}finally{o.value=!1}},setInsurers:u,setSelectedInsurer:function(e){console.log("Setting selected insurer in store:",e),n.value=e?{...e}:null},setLastInvoices:function(e){console.log("Setting last invoices in store:",e),s.value={...e}},updateInsurerLastInvoice:async function(t,r){console.log("=== updateInsurerLastInvoice ==="),console.log("Updating insurer last invoice in store:",{insurerId:t,lastInvoice:r});try{o.value=!0,a.value=null;const i=e.value.findIndex(e=>e.id===t);if(-1===i)throw new Error(`Insurer with ID ${t} not found`);const u=JSON.parse(JSON.stringify(e.value[i]));u.last_invoice=r,console.log("Updated insurer object:",u);const c=[...e.value];c[i]=u,e.value=c,n.value&&n.value.id===t&&(n.value={...u});try{const e=P(),n=l.value,s=n.replace("insurers","invoices");console.log(`Updating document in '${n}' and '${s}'`);const o=O(e,n,t);await U(o,{last_invoice:r});const a=O(e,s,"last_invoices");await U(a,{[t]:r}),console.log("Firebase updates successful for both collections.")}catch(s){console.error("Firebase update failed:",s),a.value="Failed to save to database, but UI is updated"}return u}catch(i){throw console.error("Error updating insurer last invoice:",i),a.value=i.message,i}finally{o.value=!1}}}}),X=(e,t)=>{const r=e.__vccOpts||e;for(const[n,s]of t)r[n]=s;return r},Z={class:"app"},Q={key:0,class:"debug-panel"},ee={key:0,class:"debug-content"},te={class:"debug-section"},re={key:0,class:"error"},ne={class:"debug-section"},se={key:1,class:"error-boundary"};const oe=X({name:"App",components:{ErrorBoundary:{setup(){const e=t(!1),r=t("");c(t=>(console.error("Error captured in component:",t),e.value=!0,r.value=t.message,!1));return{hasError:e,errorMessage:r,reloadApp:()=>{window.location.reload()}}}}},setup(){d();const e=W(),r=!1,n=t(r),s=t(!1),o=t(null),a=t(!1);return u(async()=>{}),{isDevelopment:r,isOpen:n,isFirebaseConnected:s,environment:"production",error:o,isLoading:a,toggleDebug:()=>{n.value=!n.value},testFirebase:async()=>{try{a.value=!0,o.value=null,s.value=await e.testFirestoreConnection()}catch(t){console.error("Firebase test failed:",t),o.value=t.message}finally{a.value=!1}},showStoreState:()=>{e.debugStoreState()},clearError:()=>{o.value=null}}}},[["render",function(e,t,r,u,c,d){const p=g("router-view");return m(),n("div",Z,[u.isDevelopment?(m(),n("div",Q,[a("div",{class:"debug-header",onClick:t[0]||(t[0]=(...e)=>u.toggleDebug&&u.toggleDebug(...e))},[a("span",null,"Debug Panel ("+l(u.isOpen?"▼":"▶")+")",1),a("span",{class:i(["debug-status",{"status-ok":u.isFirebaseConnected,"status-error":!u.isFirebaseConnected}])},l(u.isFirebaseConnected?"Firebase: Connected":"Firebase: Disconnected"),3)]),u.isOpen?(m(),n("div",ee,[a("div",te,[t[5]||(t[5]=a("h4",null,"App State",-1)),a("pre",null,"Environment: "+l(u.environment),1),a("pre",null,"Loading: "+l(u.isLoading),1),u.error?(m(),n("pre",re,"Error: "+l(u.error),1)):s("",!0)]),a("div",ne,[t[6]||(t[6]=a("h4",null,"Actions",-1)),a("button",{onClick:t[1]||(t[1]=(...e)=>u.testFirebase&&u.testFirebase(...e))},"Test Firebase Connection"),a("button",{onClick:t[2]||(t[2]=(...e)=>u.showStoreState&&u.showStoreState(...e))},"Show Store State"),a("button",{onClick:t[3]||(t[3]=(...e)=>u.clearError&&u.clearError(...e))},"Clear Error")])])):s("",!0)])):s("",!0),e.hasError?(m(),n("div",se,[t[7]||(t[7]=a("h2",null,"Something went wrong",-1)),a("p",null,l(e.errorMessage),1),a("button",{onClick:t[4]||(t[4]=(...t)=>e.reloadApp&&e.reloadApp(...t))},"Reload App")])):(m(),o(p,{key:2}))])}],["__scopeId","data-v-ac82c79c"]]),ae={},le=function(e,t,r){return t&&0!==t.length?(document.getElementsByTagName("link"),Promise.all(t.map(e=>{if((e=function(e){return"/"+e}(e))in ae)return;ae[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0})).then(()=>e()).catch(e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e})):e()},ie={class:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8"},ue={class:"max-w-md w-full space-y-8"},ce={class:"rounded-md shadow-sm -space-y-px"},de=["disabled"],ge={key:0},me={key:1,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white"},pe={key:0,class:"text-red-500 text-sm text-center"},ve={__name:"Login",setup(e){const r=d(),o=t(""),i=t(""),u=t(!1),c=t(""),g=async()=>{u.value=!0,c.value="";try{const e={}.VITE_APP_ADMIN_USERNAME,t={}.VITE_APP_ADMIN_PASSWORD;if(!e||!t)throw new Error("Authentication service is not properly configured.");o.value===e&&i.value===t?(localStorage.setItem("authToken","dummy-token"),localStorage.setItem("username",o.value),r.push("/")):c.value="Ungültige Anmeldeinformationen"}catch(e){console.error("Authentication error:",e),c.value="Anmeldung fehlgeschlagen. Bitte versuchen Sie es später erneut."}finally{u.value=!1}};return(e,t)=>(m(),n("div",ie,[a("div",ue,[t[4]||(t[4]=a("div",null,[a("h2",{class:"mt-6 text-center text-3xl font-extrabold text-gray-900"}," Anmelden ")],-1)),a("form",{class:"mt-8 space-y-6",onSubmit:p(g,["prevent"])},[a("div",ce,[a("div",null,[t[2]||(t[2]=a("label",{for:"username",class:"sr-only"},"Benutzername",-1)),v(a("input",{id:"username",name:"username",type:"text",required:"","onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),class:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Benutzername"},null,512),[[f,o.value]])]),a("div",null,[t[3]||(t[3]=a("label",{for:"password",class:"sr-only"},"Passwort",-1)),v(a("input",{id:"password",name:"password",type:"password",required:"","onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 sm:text-sm",placeholder:"Passwort"},null,512),[[f,i.value]])])]),a("div",null,[a("button",{type:"submit",disabled:u.value,class:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[u.value?(m(),n("span",me,"Loading...")):(m(),n("span",ge,"Anmelden"))],8,de)]),c.value?(m(),n("div",pe,l(c.value),1)):s("",!0)],32)])]))}},fe=X(ve,[["__scopeId","data-v-ee72ac12"]]),he={class:"abrechnungen-history p-4"},ye={key:0,class:"bg-blue-50 p-4 mb-6 rounded-lg text-sm"},be={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4"},xe={class:"flex flex-wrap gap-2"},we={class:"relative"},ke=["value"],Se={class:"relative"},De=["value"],Ce={class:"bg-white shadow overflow-hidden sm:rounded-lg mb-6"},Ee={class:"px-4 py-5 sm:px-6 border-b border-gray-200"},Ie={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0"},_e={class:"w-full sm:w-1/3"},Ae={class:"relative rounded-md shadow-sm"},Me={class:"flex items-center space-x-4 w-full sm:w-auto"},Be={class:"relative"},Ve=["title"],Te={class:"overflow-x-auto"},je={class:"min-w-full divide-y divide-gray-200"},Le={class:"bg-gray-50"},ze={class:"flex items-center"},Ne={class:"flex items-center"},Pe={class:"bg-white divide-y divide-gray-200"},Fe={class:"px-6 py-4 whitespace-nowrap"},$e={class:"text-sm font-medium text-gray-900"},Oe={class:"text-xs text-gray-500"},Ue={class:"px-6 py-4 whitespace-nowrap"},He={class:"text-sm font-medium text-gray-900"},Re={key:0,class:"text-xs text-gray-500"},Ye={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},Ge=["onClick"],Je=["onClick"],We={key:0},Xe={class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ze={class:"flex-1 flex justify-between sm:hidden"},Qe=["disabled"],et={class:"text-sm text-gray-700 mx-4 flex items-center"},tt=["disabled"],rt={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},nt={class:"text-sm text-gray-700"},st={class:"font-medium"},ot={class:"font-medium"},at={class:"font-medium"},lt={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},it=["disabled"],ut={key:0,disabled:"",class:"relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700"},ct=["onClick"],dt=["disabled"],gt={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},mt={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},pt={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},vt={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},ft={class:"sm:flex sm:items-start"},ht={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"},yt={class:"mt-4 space-y-4"},bt={key:0,class:"space-y-4"},xt={class:"mt-1 text-sm text-gray-900"},wt={class:"mt-1 text-sm text-gray-900"},kt={key:0},St={class:"mt-1 text-sm text-gray-900"},Dt={class:"mt-1"},Ct={class:"mt-1"},Et={key:1},It={class:"mt-1 text-sm text-gray-900"},_t={key:2},At={class:"mt-1 text-sm text-gray-900 whitespace-pre-line"},Mt={class:"bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Bt={__name:"AbrechnungenHistory",props:{abrechnungen:{type:Array,default:()=>[]},isProductionBranch:{type:Boolean,default:!0}},setup(e){const c=e;console.log("AbrechnungenHistory received props:",c.abrechnungen);const d=t(""),p=t("date"),I=t(!1),_=t(1),A=t(10),M=t(!1),B=t(null),V=t(""),T=t(""),j=r(()=>{const e=new Set;return z.value.forEach(t=>{t.documentType&&e.add(t.documentType)}),Array.from(e).sort()}),L=r(()=>{const e=new Set;return z.value.forEach(t=>{t.status&&e.add(t.status)}),Array.from(e).sort()}),z=r(()=>c.abrechnungen?Array.isArray(c.abrechnungen)?(console.log("Local abrechnungen:",c.abrechnungen),c.abrechnungen.map(e=>({...e,documentType:e.documentType||"Rechnung",status:e.status||"Erfolgreich",reference:e.reference||"",amount:e.amount||"",notes:e.notes||""}))):(console.warn("Abrechnungen prop is not an array:",c.abrechnungen),[]):(console.warn("Abrechnungen prop is not defined"),[])),N=e=>{p.value===e?I.value=!I.value:(p.value=e,I.value=!0)},P=r(()=>{let e=[...z.value];if(d.value){const t=d.value.toLowerCase();e=e.filter(e=>e.insurer&&e.insurer.toLowerCase().includes(t)||e.reference&&e.reference.toString().toLowerCase().includes(t)||e.notes&&e.notes.toLowerCase().includes(t)||e.amount&&e.amount.toString().toLowerCase().includes(t))}return V.value&&(e=e.filter(e=>e.documentType===V.value)),T.value&&(e=e.filter(e=>e.status===T.value)),e}),F=r(()=>[...P.value].sort((e,t)=>{let r=0;if("date"===p.value){r=(e.timestamp||new Date(e.date))-(t.timestamp||new Date(t.date))}else if("insurer"===p.value)r=(e.insurer||"").localeCompare(t.insurer||"");else if("documentType"===p.value)r=(e.documentType||"").localeCompare(t.documentType||"");else if("status"===p.value)r=(e.status||"").localeCompare(t.status||"");else if("amount"===p.value){r=(parseFloat(e.amount)||0)-(parseFloat(t.amount)||0)}return I.value?r:-r})),$=r(()=>Math.max(1,Math.ceil(F.value.length/A.value))),O=r(()=>{try{if(!F.value||!Array.isArray(F.value))return console.warn("sortedAbrechnungen is not an array:",F.value),[];const e=(_.value-1)*A.value,t=e+A.value;return console.log(`Pagination: page ${_.value}, showing items ${e}-${t} of ${F.value.length}`),F.value.slice(e,t)}catch(e){return console.error("Error in paginatedAbrechnungen:",e),[]}}),U=r(()=>{const e=[],t=$.value,r=_.value;e.push(1);let n=Math.max(2,r-1),s=Math.min(t-1,r+1);r<=3?s=Math.min(4,t-1):r>=t-2&&(n=Math.max(t-3,2)),n>2&&e.push("...");for(let o=n;o<=s;o++)o>1&&o<t&&e.push(o);return s<t-1&&e.push("..."),t>1&&e.push(t),e}),H=e=>{try{let t;if("string"==typeof e)t=e.match(/^\d{2}\.\d{2}\.\d{4}(, \d{2}:\d{2})?$/)?(e=>{const[t]=e.split(","),[r,n,s]=t.split(".").map(Number);return new Date(s,n-1,r)})(e):e.match(/^\d{4}-\d{2}-\d{2}/)?K(e):new Date(e);else if(e instanceof Date)t=e;else{if(!e||!e.toDate)throw new Error("Unsupported date format");t=e.toDate()}if(isNaN(t.getTime()))throw new Error("Invalid date");return R(t,"dd.MM.yyyy")}catch(t){return console.warn("Failed to format date:",e,t),e||"Ungültiges Datum"}},q=e=>{try{let t;if("string"==typeof e){if(e.match(/, \d{2}:\d{2}$/)){return e.split(", ")[1]}t=e.match(/\d{2}:\d{2}(:\d{2})?/)?K(e):new Date(e)}else if(e instanceof Date)t=e;else{if(!e||!e.toDate)return"";t=e.toDate()}return isNaN(t.getTime())?"":R(t,"HH:mm")}catch(t){return console.warn("Failed to format time:",e,t),""}},G=e=>e.documentType||"Rechnung",J=e=>{switch((e.documentType||"").toLowerCase()){case"gutschrift":return"bg-purple-100 text-purple-800";case"rechnung":return"bg-blue-100 text-blue-800";case"mahnung":return"bg-red-100 text-red-800";case"gutschriftsanfrage":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},W=e=>{if(!e.status)return"Unbekannt";return{success:"Erfolgreich",pending:"Ausstehend",failed:"Fehlgeschlagen",erfolgreich:"Erfolgreich",ausstehend:"Ausstehend",fehlgeschlagen:"Fehlgeschlagen",bezahlt:"Bezahlt",offen:"Offen",storniert:"Storniert",teilweise_bezahlt:"Teilweise bezahlt"}[e.status.toLowerCase()]||e.status},X=e=>{if(!e.status)return"bg-gray-100 text-gray-800";const t=e.status.toLowerCase();return["erfolgreich","success","bezahlt"].includes(t)?"bg-green-100 text-green-800":["ausstehend","pending","offen","teilweise_bezahlt"].includes(t)?"bg-yellow-100 text-yellow-800":["fehlgeschlagen","failed","storniert"].includes(t)?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"},Z=()=>{M.value=!1,document.body.style.overflow="auto",setTimeout(()=>{B.value=null},300)},Q=e=>{"Escape"===e.key&&M.value&&Z()};u(()=>{window.addEventListener("keydown",Q)}),h(()=>{window.removeEventListener("keydown",Q),document.body.style.overflow="auto"});const ee=async e=>{try{if(e.downloadUrl)window.open(e.downloadUrl,"_blank");else if(e.file){const t=URL.createObjectURL(e.file),r=document.createElement("a");r.href=t,r.download=`Abrechnung_${e.insurer}_${H(e.date)}.${G(e).toLowerCase()}`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}}catch(t){console.error("Error downloading document:",t),alert("Fehler beim Herunterladen des Dokuments")}},te=()=>{try{const e=[["Datum","Uhrzeit","Versicherung","Dokumententyp","Status","Referenz","Betrag","Notizen","Dokument-URL"].join(";"),...F.value.map(e=>{const t=e.timestamp?new Date(e.timestamp):parseDate(e.date);return[t?R(t,"dd.MM.yyyy"):"",t?R(t,"HH:mm"):"",`"${e.insurer||""}"`,`"${G(e)}"`,`"${W(e)}"`,`"${e.reference||""}"`,`"${e.amount?parseFloat(e.amount).toFixed(2).replace(".",","):"0,00"}"`,`"${(e.notes||"").replace(/"/g,'""')}"`,`"${e.downloadUrl||""}"`].join(";")})].join("\n"),t=new Blob(["\ufeff",e],{type:"text/csv;charset=utf-8;"}),r=`Abrechnungen_${R(new Date,"yyyy-MM-dd")}.csv`;Y.saveAs(t,r)}catch(e){console.error("Error exporting to CSV:",e),alert("Fehler beim Exportieren der Daten: "+e.message)}};return y(d,()=>{_.value=1}),y(()=>c.abrechnungen,e=>{console.log("abrechnungen prop changed:",e)},{deep:!0}),y(()=>c.abrechnungen,()=>{_.value=1}),(e,t)=>{const r=g("SortIndicator");return m(),n(x,null,[a("div",he,[c.isProductionBranch?s("",!0):(m(),n("div",ye,[t[12]||(t[12]=a("h3",{class:"font-medium mb-2"},"Debug Information",-1)),a("p",null,"Anzahl der Abrechnungen: "+l(c.abrechnungen?c.abrechnungen.length:0),1),a("p",null,"Gefilterte Abrechnungen: "+l(P.value.length),1),a("p",null,"Sortierfeld: "+l(p.value)+" ("+l(I.value?"aufsteigend":"absteigend")+")",1),a("p",null,"Aktuelle Seite: "+l(_.value)+" / "+l($.value),1)])),a("div",be,[t[18]||(t[18]=a("div",null,[a("h2",{class:"text-2xl font-bold text-gray-800"},"Vergangene Abrechnungen"),a("p",{class:"text-sm text-gray-500 mt-1"},"Zeigt alle gespeicherten Abrechnungen")],-1)),a("div",xe,[a("div",we,[v(a("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>V.value=e),class:"appearance-none bg-white pl-3 pr-8 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[t[13]||(t[13]=a("option",{value:""},"Alle Dokumententypen",-1)),(m(!0),n(x,null,w(j.value,e=>(m(),n("option",{key:e,value:e},l(e),9,ke))),128))],512),[[b,V.value]]),t[14]||(t[14]=a("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[a("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),a("div",Se,[v(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),class:"appearance-none bg-white pl-3 pr-8 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"},[t[15]||(t[15]=a("option",{value:""},"Alle Status",-1)),(m(!0),n(x,null,w(L.value,e=>(m(),n("option",{key:e,value:e},l(W({status:e})),9,De))),128))],512),[[b,T.value]]),t[16]||(t[16]=a("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[a("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),a("button",{onClick:te,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 whitespace-nowrap"},t[17]||(t[17]=[a("svg",{class:"-ml-1 mr-2 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" Export CSV ")]))])]),a("div",Ce,[a("div",Ee,[a("div",Ie,[a("div",_e,[t[20]||(t[20]=a("label",{for:"search",class:"sr-only"},"Versicherung suchen",-1)),a("div",Ae,[t[19]||(t[19]=a("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[a("svg",{class:"h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),v(a("input",{id:"search","onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e),type:"text",class:"focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 pr-12 sm:text-sm border-gray-300 rounded-md py-2 border",placeholder:"Versicherung suchen..."},null,512),[[f,d.value]])])]),a("div",Me,[a("div",Be,[v(a("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e),class:"appearance-none bg-white pl-3 pr-10 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"},t[21]||(t[21]=[a("option",{value:"date"},"Nach Datum",-1),a("option",{value:"insurer"},"Nach Versicherung",-1)]),512),[[b,p.value]]),t[22]||(t[22]=a("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"},[a("svg",{class:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),a("button",{onClick:t[4]||(t[4]=e=>I.value=!I.value),class:"p-2 text-gray-600 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md",title:I.value?"Aufsteigend":"Absteigend"},[(m(),n("svg",{class:i(["w-5 h-5",{"transform rotate-180":!I.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[23]||(t[23]=[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"},null,-1)]),2))],8,Ve)])])]),a("div",Te,[a("table",je,[a("thead",Le,[a("tr",null,[a("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:t[5]||(t[5]=e=>N("date"))},[a("div",ze,[t[24]||(t[24]=k(" Datum ")),S(r,{active:"date"===p.value,ascending:I.value},null,8,["active","ascending"])])]),a("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:t[6]||(t[6]=e=>N("insurer"))},[a("div",Ne,[t[25]||(t[25]=k(" Versicherung ")),S(r,{active:"insurer"===p.value,ascending:I.value},null,8,["active","ascending"])])]),t[26]||(t[26]=a("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Dokumententyp ",-1)),t[27]||(t[27]=a("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Status ",-1)),t[28]||(t[28]=a("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," Aktionen ",-1))])]),a("tbody",Pe,[(m(!0),n(x,null,w(O.value,(e,t)=>(m(),n("tr",{key:t,class:"hover:bg-gray-50 transition-colors duration-150"},[a("td",Fe,[a("div",$e,l(H(e.date)),1),a("div",Oe,l(q(e.date)),1)]),a("td",Ue,[a("div",He,l(e.insurerName||e.insurer||"Unbekannt"),1),e.reference?(m(),n("div",Re,l(e.reference),1)):s("",!0)]),a("td",Ye,[G(e)?(m(),n("span",{key:0,class:i(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",J(e)])},l(G(e)),3)):s("",!0)]),a("td",Ke,[a("span",{class:i(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",X(e)])},l(W(e)),3)]),a("td",qe,[a("button",{onClick:t=>(e=>{M.value?(M.value=!1,setTimeout(()=>{B.value={...e},M.value=!0,document.body.style.overflow="hidden"},50)):(B.value={...e},M.value=!0,document.body.style.overflow="hidden")})(e),class:"text-blue-600 hover:text-blue-900 mr-4"}," Details ",8,Ge),e.downloadUrl?(m(),n("button",{key:0,onClick:t=>ee(e),class:"text-indigo-600 hover:text-indigo-900"}," Herunterladen ",8,Je)):s("",!0)])]))),128)),0===P.value.length?(m(),n("tr",We,t[29]||(t[29]=[a("td",{colspan:"5",class:"px-6 py-4 text-center text-sm text-gray-500"}," Keine Einträge gefunden. ",-1)]))):s("",!0)])])]),a("div",Xe,[a("div",Ze,[a("button",{onClick:t[7]||(t[7]=e=>_.value=Math.max(1,_.value-1)),disabled:1===_.value,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Zurück ",8,Qe),a("div",et," Seite "+l(_.value)+" von "+l($.value),1),a("button",{onClick:t[8]||(t[8]=e=>_.value=Math.min($.value,_.value+1)),disabled:_.value>=$.value,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Weiter ",8,tt)]),a("div",rt,[a("div",null,[a("p",nt,[t[30]||(t[30]=k(" Zeige ")),a("span",st,l((_.value-1)*A.value+1),1),t[31]||(t[31]=k(" bis ")),a("span",ot,l(Math.min(_.value*A.value,P.value.length)),1),t[32]||(t[32]=k(" von ")),a("span",at,l(P.value.length),1),t[33]||(t[33]=k(" Ergebnissen "))])]),a("div",null,[a("nav",lt,[a("button",{onClick:t[9]||(t[9]=e=>_.value=Math.max(1,_.value-1)),disabled:1===_.value,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[34]||(t[34]=[a("span",{class:"sr-only"},"Vorherige",-1),a("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[a("path",{"fill-rule":"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)]),8,it),(m(!0),n(x,null,w(U.value,e=>(m(),n(x,{key:e},["..."===e?(m(),n("button",ut,l(e),1)):(m(),n("button",{key:1,onClick:t=>_.value=e,class:i(["relative inline-flex items-center px-4 py-2 border text-sm font-medium",_.value===e?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"])},l(e),11,ct))],64))),128)),a("button",{onClick:t[10]||(t[10]=e=>_.value=Math.min($.value,_.value+1)),disabled:_.value>=$.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[35]||(t[35]=[a("span",{class:"sr-only"},"Nächste",-1),a("svg",{class:"h-5 w-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},[a("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})],-1)]),8,dt)])])])])])]),(m(),o(E,{to:"body"},[S(C,{name:"modal"},{default:D(()=>[M.value?(m(),n("div",gt,[a("div",mt,[S(C,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:D(()=>[a("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:Z})]),_:1}),t[44]||(t[44]=a("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),S(C,{"enter-active-class":"ease-out duration-300","enter-from-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to-class":"opacity-100 translate-y-0 sm:scale-100","leave-active-class":"ease-in duration-200","leave-from-class":"opacity-100 translate-y-0 sm:scale-100","leave-to-class":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:D(()=>[a("div",pt,[a("div",vt,[a("div",ft,[a("div",ht,[t[43]||(t[43]=a("h3",{class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"}," Abrechnungsdetails ",-1)),a("div",yt,[B.value?(m(),n("div",bt,[a("div",null,[t[36]||(t[36]=a("dt",{class:"text-sm font-medium text-gray-500"},"Versicherung",-1)),a("dd",xt,l(B.value.insurer),1)]),a("div",null,[t[37]||(t[37]=a("dt",{class:"text-sm font-medium text-gray-500"},"Datum & Uhrzeit",-1)),a("dd",wt,l(H(B.value.date))+", "+l(q(B.value.date))+" Uhr",1)]),B.value.reference?(m(),n("div",kt,[t[38]||(t[38]=a("dt",{class:"text-sm font-medium text-gray-500"},"Referenz",-1)),a("dd",St,l(B.value.reference),1)])):s("",!0),a("div",null,[t[39]||(t[39]=a("dt",{class:"text-sm font-medium text-gray-500"},"Dokumententyp",-1)),a("dd",Dt,[a("span",{class:i(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",J(B.value)])},l(G(B.value)||"Nicht angegeben"),3)])]),a("div",null,[t[40]||(t[40]=a("dt",{class:"text-sm font-medium text-gray-500"},"Status",-1)),a("dd",Ct,[a("span",{class:i(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",X(B.value)])},l(W(B.value)),3)])]),B.value.amount?(m(),n("div",Et,[t[41]||(t[41]=a("dt",{class:"text-sm font-medium text-gray-500"},"Betrag",-1)),a("dd",It,l(B.value.amount)+" €",1)])):s("",!0),B.value.notes?(m(),n("div",_t,[t[42]||(t[42]=a("dt",{class:"text-sm font-medium text-gray-500"},"Notizen",-1)),a("dd",At,l(B.value.notes),1)])):s("",!0)])):s("",!0)])])])]),a("div",Mt,[a("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:Z}," Schließen "),B.value?.downloadUrl?(m(),n("button",{key:0,type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:t[11]||(t[11]=e=>ee(B.value))}," Herunterladen ")):s("",!0)])])]),_:1})])])):s("",!0)]),_:1})]))],64)}}},Vt=X(Bt,[["__scopeId","data-v-d35059b2"]]),Tt={class:"grid grid-cols-1 gap-3 w-full"},jt=["onClick"],Lt={class:"flex items-center"},zt={class:"flex-1"};const Nt=X({name:"StatusSummary",props:{statusCounts:{type:Object,required:!0,default:()=>({on_time:0,warning:0,critical:0,unknown:0})},activeStatus:{type:String,default:"all"}},emits:["status-clicked"],methods:{isActive(e){return this.activeStatus===e},handleStatusClick(e){this.$emit("status-clicked",{status:e}),console.log(`${e} button clicked`)},getStatusColor(e,t="text"){const r={on_time:{text:"text-green-600",bg:"bg-green-500",light:"bg-green-50",dark:"bg-green-600",border:"border-green-200"},yellow:{text:"text-yellow-600",bg:"bg-yellow-500",light:"bg-yellow-50",dark:"bg-yellow-600",border:"border-yellow-200"},warning:{text:"text-yellow-600",bg:"bg-yellow-500",light:"bg-yellow-50",dark:"bg-yellow-600",border:"border-yellow-200"},red:{text:"text-red-600",bg:"bg-red-500",light:"bg-red-50",dark:"bg-red-600",border:"border-red-200"},critical:{text:"text-red-600",bg:"bg-red-500",light:"bg-red-50",dark:"bg-red-600",border:"border-red-200"},total:{text:"text-blue-600",bg:"bg-blue-500",light:"bg-blue-50",dark:"bg-blue-600",border:"border-blue-200"},unknown:{text:"text-gray-600",bg:"bg-gray-400",light:"bg-gray-50",dark:"bg-gray-600",border:"border-gray-200"}},n=r[e]||r.unknown;return n[t]||n.text},getStatusCardClass(e){return`${this.getStatusColor(e,"bg")} bg-opacity-10 hover:bg-opacity-15 border hover:shadow-lg transform hover:-translate-y-1 transition-transform ${{yellow:"border-yellow-200",warning:"border-yellow-200",red:"border-red-200",critical:"border-red-200",total:"border-blue-200",on_time:"border-green-200",unknown:"border-gray-200"}[e]||""}`},getStatusTextColor(e,t=!1){const r=this.getStatusColor(e,"text");return t?`font-bold ${r}`:r},getStatusText:e=>({on_time:"Im Plan",yellow:"Warnung",warning:"Warnung",red:"Kritisch",critical:"Kritisch",total:"Gesamt",unknown:"Unbekannt"}[e]||e)}},[["render",function(e,t,r,s,o,u){return m(),n("div",Tt,[(m(!0),n(x,null,w(r.statusCounts,(e,t)=>(m(),n("div",{key:t,class:i(["relative overflow-hidden rounded-xl p-4 transition-all duration-200 hover:shadow-md w-full cursor-pointer",[u.getStatusCardClass(t),u.isActive(t)?"ring-2 ring-offset-2":""]]),onClick:e=>u.handleStatusClick(t)},[a("div",Lt,[a("div",{class:i(["flex-shrink-0 w-4 h-4 rounded-full mr-3",u.getStatusColor(t,"bg")])},null,2),a("div",zt,[a("div",{class:i(["text-sm font-medium",u.getStatusTextColor(t)])},l(u.getStatusText(t)),3),a("div",{class:i(["text-2xl font-bold leading-tight mt-1",u.getStatusTextColor(t,!0)])},l(e),3)])])],10,jt))),128))])}]]),Pt={class:"relative"},Ft={class:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none"},$t=["value"];const Ot=X({name:"SearchBar",data:()=>({isFocused:!1}),props:{modelValue:{type:String,default:""}},emits:["update:modelValue"],methods:{clearSearch(){this.$emit("update:modelValue",""),this.$nextTick(()=>{this.$el.querySelector("input").focus()})}}},[["render",function(e,t,r,o,l,u){return m(),n("div",Pt,[a("div",Ft,[(m(),n("svg",{class:i(["h-5 w-5 text-gray-400 transition-colors duration-200",{"text-blue-500":l.isFocused}]),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},t[4]||(t[4]=[a("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"},null,-1)]),2))]),a("input",{type:"text",class:i(["block w-full pl-12 pr-10 py-3 rounded-xl border-0 bg-white shadow-sm ring-1 ring-gray-200 placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-200 text-gray-900 sm:text-sm",{"ring-blue-500 ring-2":l.isFocused}]),value:r.modelValue,onInput:t[0]||(t[0]=t=>e.$emit("update:modelValue",t.target.value)),onFocus:t[1]||(t[1]=e=>l.isFocused=!0),onBlur:t[2]||(t[2]=e=>l.isFocused=!1),placeholder:"Versicherer suchen...","aria-label":"Versicherer suchen"},null,42,$t),S(C,{"enter-active-class":"transition-opacity duration-200 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-150 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:D(()=>[r.modelValue?(m(),n("button",{key:0,onClick:t[3]||(t[3]=(...e)=>u.clearSearch&&u.clearSearch(...e)),class:"absolute inset-y-0 right-0 pr-4 flex items-center focus:outline-none","aria-label":"Suche zurücksetzen"},t[5]||(t[5]=[a("div",{class:"flex items-center justify-center w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 transition-colors duration-200"},[a("svg",{class:"h-4 w-4 text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)]))):s("",!0)]),_:1})])}],["__scopeId","data-v-6165b4b9"]]),Ut=e=>e?"object"==typeof e&&null!==e?e.timestamp?new Date(e.timestamp):e.display?Ht(e.display):null:"string"==typeof e?Ht(e):null:null,Ht=e=>{try{const[t,r]=e.split(",").map(e=>e.trim()),[n,s,o]=t.split(".").map(Number);if(r){const[e,t]=r.split(":").map(Number);return new Date(o,s-1,n,e,t)}return new Date(o,s-1,n)}catch(t){return console.error("Error parsing date string:",e,t),null}},Rt=(e,t=null)=>{if(!e?.last_invoice||!e?.turnus)return 0;try{const r=Ut(e.last_invoice);if(!r)return 0;const n=t||new Date,s=e.turnus.match(/(\d+)-tägig/);if(!s)return 0;const o=parseInt(s[1]),a=new Date(n);if(a.setDate(a.getDate()-o),r>=a)return 0;const l=Math.floor((a-r)/864e5);return Math.max(1,l)}catch(r){return console.error("Error calculating days overdue:",r),0}},Yt=(e,t=null)=>{if(!e?.last_invoice||!e?.turnus)return!1;try{const r=Ut(e.last_invoice);if(!r)return!1;const n=t||new Date,s=e.turnus.match(/(\d+)-tägig/);if(!s)return!1;const o=parseInt(s[1]),a=new Date(n);return a.setDate(a.getDate()-o),r<a}catch(r){return console.error("Error checking overdue status:",r),!1}},Kt=(e,t=null)=>{if(!e?.last_invoice||!e?.turnus)return"gray";try{const r=Rt(e,t);return r>5?"red":r>0?"yellow":"green"}catch(r){return console.error("Error getting status color:",r),"gray"}},qt=(e,t=null)=>{if(!e?.turnus||!e?.last_invoice)return"";const r=Rt(e,t);return 0===r?"Abrechnung OK":r>0&&r<=5?`Überfällig (${r} Tage)`:r>5?"Überfällig (>5 Tage)":""},Gt={class:"h-full flex flex-col"},Jt={class:"flex items-center justify-between mb-4"},Wt={class:"text-gray-800"},Xt={class:"ml-2 px-2 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium rounded-full"},Zt={class:"flex items-center space-x-2"},Qt={class:"flex-1 overflow-y-auto w-full -mr-3 pr-1"},er={class:"grid grid-cols-1 md:grid-cols-2 gap-6 p-3"},tr=["onClick","onKeydown"],rr={class:"flex flex-1 flex-col h-full"},nr={class:"flex items-start justify-between mb-3 min-w-0"},sr={class:"flex items-center min-w-0"},or={class:"font-semibold text-gray-900 group-hover:text-blue-600 transition-colors break-words"},ar={key:0,class:"flex-shrink-0 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ml-2 bg-gray-100 text-gray-800"},lr={key:1,class:"flex-shrink-0 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ml-2 bg-red-100 text-red-800"},ir={key:2,class:"flex-shrink-0 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ml-2 bg-yellow-100 text-yellow-800"},ur={key:3,class:"flex-shrink-0 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ml-2 bg-green-100 text-green-800"},cr={class:"flex-1 grid grid-cols-2 gap-3 text-sm"},dr={class:"space-y-2"},gr={key:0,class:"flex items-start"},mr={class:"font-medium"},pr={key:1,class:"flex items-start"},vr={class:"font-medium"},fr={class:"space-y-2"},hr={key:0,class:"flex items-start"},yr={key:1,class:"flex items-start"},br={class:"font-medium"},xr={class:"mt-3 flex flex-wrap gap-2"},wr={key:0,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-100 text-blue-800"},kr={key:1,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-red-100 text-red-800"},Sr={key:2,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-green-100 text-green-800"},Dr={key:3,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-purple-100 text-purple-800"},Cr={key:4,class:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800"},Er={key:5,class:"text-xs text-gray-500"},Ir={class:"mt-3 pt-2 border-t border-gray-100 flex justify-between items-center"},_r={class:"text-xs text-gray-500"},Ar=X({__name:"InsurerList",props:{insurers:{type:Array,required:!0},selectedInsurer:{type:Object,default:null}},emits:["select-insurer","clear-selection"],setup(e,{emit:r}){const o=e,c=r;t(null);const d=t(null),g=W(),p=e=>{o.selectedInsurer?.name===e.name?(g.setSelectedInsurer(null),c("clear-selection")):(g.setSelectedInsurer(e),c("select-insurer",e)),nextTick(()=>{d.value=document.querySelector('[data-selected="true"]')})};u(()=>{console.log("InsurerList mounted with insurers:",o.insurers),o.insurers&&o.insurers.length>0&&(console.log("First insurer data:",o.insurers[0]),console.log("First insurer dokumentenart:",o.insurers[0].dokumentenart)),o.selectedInsurer&&nextTick(()=>{d.value&&d.value.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})})});const v=e=>{if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?e:t.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"})},f=e=>!1===e.complete,h=e=>{console.log("=== formatLastInvoice called ===");try{if(console.log("Input dateValue:",e),console.log("Type of dateValue:",typeof e),console.log("Constructor:",e?.constructor?.name),null==e)return console.log("dateValue is null or undefined, returning empty string"),"";if("object"==typeof e&&null!==e){if(console.log("dateValue is an object with keys:",Object.keys(e)),e.date){console.log("Using date property (ISO):",e.date);try{const t=new Date(e.date);if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE");return console.log("Formatted date from ISO string:",e),e}}catch(t){console.error("Error parsing date from ISO string:",t)}}if(e.display){console.log("Using display property:",e.display);const t=e.display.split(",")[0].trim();return console.log("Extracted date from display:",t),t}if(e.timestamp){console.log("Using timestamp property:",e.timestamp);try{const t=new Date(Number(e.timestamp));if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE");return console.log("Formatted timestamp:",e),e}}catch(t){console.error("Error parsing timestamp:",t)}}if("function"==typeof e.toISOString){console.log("Using toISOString() method");try{const t=new Date(e.toISOString());if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE");return console.log("Formatted ISO date:",e),e}}catch(t){console.error("Error calling toISOString():",t)}}for(const r in e)if(e.hasOwnProperty(r)&&(r.toLowerCase().includes("date")||r.toLowerCase().includes("time"))){console.log(`Trying to use property '${r}':`,e[r]);try{const t=new Date(e[r]);if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE");return console.log(`Formatted date from property '${r}':`,e),e}}catch(t){console.error(`Error parsing date from property '${r}':`,t)}}return console.log("No valid date properties found in object"),""}if("string"==typeof e){if(console.log("dateValue is a string:",e),/^\d{1,2}\.\d{1,2}\.\d{4}$/.test(e.trim()))return console.log("dateValue is already in DD.MM.YYYY format, returning as is"),e.trim();const r=e.match(/^(\d{1,2}\.\d{1,2}\.\d{4})/);if(r&&r[1])return console.log("Extracted date from DD.MM.YYYY, HH:mm format:",r[1]),r[1];try{const t=new Date(e);if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE");return console.log("Formatted date from string:",e),e}}catch(t){console.error("Error parsing date string:",t)}return console.log("Could not parse as Date, returning first part before comma"),e.split(",")[0].trim()}try{console.log("Trying last resort string conversion");const t=String(e);if(console.log("String representation:",t),"[object Object]"!==t){const e=t.split(",")[0].trim();if(console.log("Extracted date part from string:",e),e)return e}else console.log("String representation is [object Object], skipping")}catch(t){console.error("Error converting dateValue to string:",t)}return console.log("Could not format date, returning empty string"),""}catch(t){return console.error("Error in formatLastInvoice:",t),""}finally{console.log("=== End of formatLastInvoice ===\n")}};return(t,r)=>(m(),n("div",Gt,[a("div",Jt,[a("div",Wt,[a("span",Xt,l(e.insurers.length)+" Einträge ",1)]),a("div",Zt,[e.selectedInsurer?(m(),n("button",{key:0,onClick:r[0]||(r[0]=e=>t.$emit("clear-selection")),class:"text-xs text-gray-500 hover:text-gray-700 flex items-center transition-colors"},r[1]||(r[1]=[a("svg",{class:"w-3.5 h-3.5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),k(" Auswahl aufheben ")]))):s("",!0)])]),a("div",Qt,[a("div",er,[(m(!0),n(x,null,w(e.insurers,t=>{return m(),n("div",{key:t.name,class:i(["group relative p-6 rounded-xl cursor-pointer","bg-white border border-gray-200","hover:shadow-lg hover:border-transparent","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50",e.selectedInsurer?.name===t.name?"ring-2 ring-blue-500 ring-opacity-50 border-transparent transform scale-[0.99] shadow-md":"hover:scale-[1.01]","h-full min-h-[140px] flex flex-col","transition-all duration-200 hover:shadow-md",f(t)?"incomplete-tile opacity-50 grayscale":""]),onClick:e=>p(t),onKeydown:I(e=>p(t),["enter"]),tabindex:"0"},[a("div",{class:i(["absolute top-0 left-0 w-1.5 h-full rounded-l-lg",{"bg-red-500":"red"===_(Kt)(t),"bg-yellow-500":"yellow"===_(Kt)(t),"bg-green-500":"green"===_(Kt)(t)||"gray"===_(Kt)(t)}])},null,2),a("div",rr,[a("div",nr,[a("div",sr,[a("div",{class:i(["flex-shrink-0 w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-lg mr-3",{"bg-red-500":"red"===_(Kt)(t),"bg-yellow-500":"yellow"===_(Kt)(t),"bg-blue-500":"green"===_(Kt)(t)||"gray"===_(Kt)(t)}])},l((o=t.name,o?o.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"--")),3),a("h3",or,l(t.name),1)]),f(t)?(m(),n("span",ar," Unvollständig ")):"red"===_(Kt)(t)?(m(),n("span",lr," Überfällig (>5 Tage) ")):"yellow"===_(Kt)(t)?(m(),n("span",ir,l(_(qt)(t)),1)):(m(),n("span",ur," Aktuell "))]),a("div",cr,[a("div",dr,[t.turnus?(m(),n("div",gr,[r[3]||(r[3]=a("svg",{class:"w-4 h-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)),a("div",null,[r[2]||(r[2]=a("div",{class:"text-xs text-gray-500"},"Turnus",-1)),a("div",mr,l(t.turnus),1)])])):s("",!0),t.contact_person?(m(),n("div",pr,[r[5]||(r[5]=a("svg",{class:"w-4 h-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),a("div",null,[r[4]||(r[4]=a("div",{class:"text-xs text-gray-500"},"Ansprechpartner",-1)),a("div",vr,l(t.contact_person),1)])])):s("",!0)]),a("div",fr,[t.last_invoice?(m(),n("div",hr,[r[7]||(r[7]=a("svg",{class:"w-4 h-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),a("div",null,[r[6]||(r[6]=a("div",{class:"text-xs text-gray-500"},"Letzte Rechnung",-1)),a("div",{class:i(["font-medium",_(Yt)(t)?"text-red-600":"text-green-600"])},l(h(t.last_invoice)),3)])])):s("",!0),t.next_due?(m(),n("div",yr,[r[9]||(r[9]=a("svg",{class:"w-4 h-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),a("div",null,[r[8]||(r[8]=a("div",{class:"text-xs text-gray-500"},"Fällig am",-1)),a("div",br,l(v(t.next_due)),1)])])):s("",!0)])]),a("div",xr,[t.dokumentenart&&t.dokumentenart.includes("CSV")?(m(),n("span",wr,r[10]||(r[10]=[a("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" CSV ")]))):s("",!0),t.dokumentenart&&t.dokumentenart.includes("PDF")?(m(),n("span",kr,r[11]||(r[11]=[a("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),k(" PDF ")]))):s("",!0),t.dokumentenart&&t.dokumentenart.includes("XLS")?(m(),n("span",Sr,r[12]||(r[12]=[a("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" Excel ")]))):s("",!0),t.dokumentenart&&t.dokumentenart.includes("XML")?(m(),n("span",Dr,r[13]||(r[13]=[a("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1),k(" XML ")]))):s("",!0),t.dokumentenart&&t.dokumentenart.includes("Papier")?(m(),n("span",Cr,r[14]||(r[14]=[a("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" Papier ")]))):s("",!0),t.dokumentenart&&0!==t.dokumentenart.length?s("",!0):(m(),n("span",Er," Keine Formate angegeben "))]),a("div",Ir,[a("span",_r," Zuletzt aktualisiert: "+l(v(t.updated_at||new Date)),1),r[15]||(r[15]=a("button",{class:"text-blue-600 hover:text-blue-800 text-sm font-medium"}," Details anzeigen ",-1))])])],42,tr);var o}),128))])])]))}},[["__scopeId","data-v-2452d511"]]),Mr={class:"max-w-2xl w-full bg-white rounded-lg shadow-xl transform transition-all duration-300"},Br={class:"p-6"},Vr={class:"mb-6"},Tr={class:"flex items-center gap-3"},jr={class:"mb-6"},Lr={class:"space-y-4"},zr={key:0,class:"p-4 bg-blue-50 rounded-lg border border-blue-200"},Nr={class:"text-gray-600"},Pr={key:1,class:"p-4 bg-teal-50 rounded-lg border border-teal-200"},Fr={class:"text-gray-600"},$r={key:2,class:"p-4 bg-indigo-50 rounded-lg border border-indigo-200"},Or={class:"flex flex-wrap gap-2"},Ur={key:0,class:"inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-blue-100 text-blue-800"},Hr={key:1,class:"inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-red-100 text-red-800"},Rr={key:2,class:"inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-green-100 text-green-800"},Yr={key:3,class:"inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-purple-100 text-purple-800"},Kr={key:4,class:"inline-flex items-center px-3 py-1 rounded-md text-sm font-medium bg-gray-100 text-gray-800"},qr={key:3,class:"p-4 bg-yellow-50 rounded-lg border border-yellow-200"},Gr={class:"text-gray-600"},Jr={key:4,class:"p-4 bg-red-50 rounded-lg border border-red-200"},Wr={class:"text-gray-600"},Xr={key:5,class:"p-4 bg-orange-50 rounded-lg border border-orange-200"},Zr={class:"text-gray-600"},Qr={key:0,class:"mb-6"},en={class:"p-4 bg-green-50 rounded-lg border border-green-200"},tn={class:"text-xs text-gray-500 mb-2 p-2 bg-gray-100 rounded"},rn={key:0},nn={class:"mt-4 text-sm"},sn={key:0,class:"text-gray-600"},on={key:1,class:"text-gray-600"},an={class:"mt-2 p-2 bg-gray-100 rounded text-xs"},ln={key:1,class:"mb-6"},un={class:"p-4 bg-purple-50 rounded-lg border border-purple-200"},cn={class:"text-gray-600 whitespace-pre-line"},dn={key:2,class:"mb-6"},gn={class:"p-4 bg-gray-50 rounded-lg border border-gray-200"},mn={class:"text-gray-600 whitespace-pre-line"},pn={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},vn={class:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md"},fn={class:"mb-4"},hn={class:"flex justify-end space-x-3"},yn=["disabled"],bn={__name:"InsurerDetail",props:{insurer:{type:Object,required:!0},lastInvoices:{type:Array,default:()=>[]},currentDate:{type:[Date,String],required:!0},isProductionBranch:{type:Boolean,default:!0}},emits:["close","settlement-completed"],setup(e,{emit:o}){W();const c=t(!1),d=t(""),g=t(null);u(()=>{const e=new Date,t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();d.value=`${n}-${r}-${t}`,p.isProductionBranch||console.log("Insurer data:",p.insurer),p.insurer&&(p.isProductionBranch||console.log("Dokumentenart:",p.insurer.dokumentenart))});const p=e,h=o;t(!1);const y=()=>{c.value=!0,setTimeout(()=>{g.value&&g.value.focus()},100)},b=async e=>{p.isProductionBranch||console.log("=== handleDateSubmit ===");try{p.isProductionBranch||console.log("Starting handleDateSubmit with date:",e);const r=e||d.value;if(!r)return void(p.isProductionBranch||console.error("No date provided"));p.isProductionBranch||console.log("Input date:",r);const n=new Date(r);n.setHours(14,0,0,0);const s=n.getTime(),o=String(n.getDate()).padStart(2,"0"),a=String(n.getMonth()+1).padStart(2,"0"),l=`${o}.${a}.${n.getFullYear()}`;p.isProductionBranch||console.log("Creating date object:",{inputDate:r,parsedDate:n.toString(),isoString:n.toISOString(),timestamp:s,displayDate:l});const i={display:l,timestamp:s,date:n.toISOString()};p.isProductionBranch||console.log("Created last_invoice object:",JSON.stringify(i,null,2));try{const e={insurer:p.insurer,newDate:n,displayDate:l,last_invoice:i};p.isProductionBranch||console.log("Emitting settlement-completed event with data:",JSON.stringify(e,null,2)),h("settlement-completed",e),p.isProductionBranch||console.log("settlement-completed event emitted successfully")}catch(t){throw p.isProductionBranch||console.error("Error updating insurer data:",t),t}p.isProductionBranch||console.log("Date picker closed"),c.value=!1}catch(t){throw p.isProductionBranch||console.error("Error in handleDateSubmit:",t),t instanceof Error&&(p.isProductionBranch||console.error("Error name:",t.name),p.isProductionBranch||console.error("Error message:",t.message),p.isProductionBranch||console.error("Error stack:",t.stack)),t}},x=()=>{c.value=!1;const e=new Date,t=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();d.value=`${n}-${r}-${t}`};r(()=>{if(p.isProductionBranch||console.log("formattedLastInvoice called with:",p.insurer.last_invoice),!p.insurer.last_invoice)return p.isProductionBranch||console.log("No last_invoice, returning empty string"),"";let e="";const t=p.insurer.last_invoice;if("object"==typeof t&&null!==t){if(p.isProductionBranch||console.log("last_invoice is an object with keys:",Object.keys(t)),t.date){p.isProductionBranch||console.log("Using date property (ISO):",t.date);const r=new Date(t.date);isNaN(r.getTime())||(e=r.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),p.isProductionBranch||console.log("Formatted date from ISO string:",e))}else if(t.display)p.isProductionBranch||console.log("Using display property:",t.display),e=t.display.split(",")[0].trim(),p.isProductionBranch||console.log("Extracted date from display:",e);else if(t.timestamp){p.isProductionBranch||console.log("Using timestamp property:",t.timestamp);const r=new Date(Number(t.timestamp));isNaN(r.getTime())||(e=r.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),p.isProductionBranch||console.log("Formatted date from timestamp:",e))}}else if("string"==typeof t&&""!==t.trim())if(p.isProductionBranch||console.log("last_invoice is a string:",t),t.includes("T")&&!isNaN(Date.parse(t))){e=new Date(t).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),p.isProductionBranch||console.log("Formatted ISO date string:",e)}else e=t.split(",")[0].trim(),p.isProductionBranch||console.log("Extracted date from string:",e);if(!e)return p.isProductionBranch||console.log("No date string extracted, returning empty string"),"";p.isProductionBranch||console.log("Final date string to format:",e);try{if(/^\d{1,2}\.\d{1,2}\.\d{4}$/.test(e)){const[t,r,n]=e.split(".").map(Number),s=new Date(n,r-1,t);if(isNaN(s.getTime()))return p.isProductionBranch||console.log("Invalid date from DD.MM.YYYY format, returning as is"),e;const o=s.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return p.isProductionBranch||console.log("Formatted date from DD.MM.YYYY:",o),o}const t=new Date(e);if(!isNaN(t.getTime())){const e=t.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});return p.isProductionBranch||console.log("Formatted date from Date object:",e),e}return p.isProductionBranch||console.log("Could not parse date, returning as is:",e),e}catch(r){p.isProductionBranch||console.error("Error formatting date:",r);const t=e.split(" ")[0].split(",")[0].trim();return p.isProductionBranch||console.log("Error case, returning:",t),t}});const w=r(()=>p.insurer.turnus?p.insurer.turnus.replace(/-/g,"-"):"");return(t,r)=>(m(),n("div",Mr,[a("div",Br,[r[25]||(r[25]=a("div",{class:"mb-6"},null,-1)),a("div",Vr,[a("div",Tr,[a("div",{class:i(["w-3 h-3 rounded-full",{"bg-red-500":"red"===_(Kt)(e.insurer),"bg-yellow-500":"yellow"===_(Kt)(e.insurer),"bg-green-500":"green"===_(Kt)(e.insurer),"bg-gray-300":"gray"===_(Kt)(e.insurer)}])},null,2),a("span",{class:i(["text-sm font-medium",{"text-red-600":"red"===_(Kt)(e.insurer),"text-yellow-600":"yellow"===_(Kt)(e.insurer),"text-green-600":"green"===_(Kt)(e.insurer),"text-gray-500":"gray"===_(Kt)(e.insurer)}])},l(_(qt)(e.insurer)),3)])]),a("div",jr,[r[14]||(r[14]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Abrechnung",-1)),a("div",Lr,[e.insurer.turnus?(m(),n("div",zr,[r[3]||(r[3]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-blue-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),a("span",{class:"font-medium text-blue-800"},"Turnus")],-1)),a("p",Nr,l(w.value),1)])):s("",!0),e.insurer.bezugsweg?(m(),n("div",Pr,[r[4]||(r[4]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-teal-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),a("span",{class:"font-medium text-teal-800"},"Bezugsweg")],-1)),a("p",Fr,l(e.insurer.bezugsweg),1)])):s("",!0),e.insurer.dokumentenart&&e.insurer.dokumentenart.length>0?(m(),n("div",$r,[r[10]||(r[10]=a("div",{class:"flex items-center mb-3"},[a("svg",{class:"w-5 h-5 text-indigo-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),a("span",{class:"font-medium text-indigo-800"},"Verfügbare Formate")],-1)),a("div",Or,[e.insurer.dokumentenart.includes("CSV")?(m(),n("span",Ur,r[5]||(r[5]=[a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" CSV ")]))):s("",!0),e.insurer.dokumentenart.includes("PDF")?(m(),n("span",Hr,r[6]||(r[6]=[a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),k(" PDF ")]))):s("",!0),e.insurer.dokumentenart.includes("XLS")?(m(),n("span",Rr,r[7]||(r[7]=[a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" Excel ")]))):s("",!0),e.insurer.dokumentenart.includes("XML")?(m(),n("span",Yr,r[8]||(r[8]=[a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"})],-1),k(" XML ")]))):s("",!0),e.insurer.dokumentenart.includes("Papier")?(m(),n("span",Kr,r[9]||(r[9]=[a("svg",{class:"w-4 h-4 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1),k(" Papier ")]))):s("",!0)])])):s("",!0),e.insurer.dokumentenart?(m(),n("div",qr,[r[11]||(r[11]=A('<div class="flex items-center mb-2"><svg class="w-5 h-5 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg><span class="font-medium text-yellow-800">Dokumentenart</span></div>',1)),a("p",Gr,l(e.insurer.dokumentenart),1)])):s("",!0),e.insurer.kontakt?(m(),n("div",Jr,[r[12]||(r[12]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-red-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})]),a("span",{class:"font-medium text-red-800"},"Kontakt")],-1)),a("p",Wr,l(e.insurer.kontakt),1)])):s("",!0),e.insurer.login?(m(),n("div",Xr,[r[13]||(r[13]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-orange-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})]),a("span",{class:"font-medium text-orange-800"},"Login")],-1)),a("p",Zr,l(e.insurer.login),1)])):s("",!0)])]),e.insurer.last_invoice?(m(),n("div",Qr,[r[18]||(r[18]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Letzte Abrechnung",-1)),a("div",en,[a("div",tn,[a("div",null,"Debug - last_invoice type: "+l(typeof e.insurer.last_invoice),1),a("div",null,"Debug - last_invoice: "+l(JSON.stringify(e.insurer.last_invoice)),1),"object"==typeof e.insurer.last_invoice?(m(),n("div",rn,[a("div",null,"Debug - has display: "+l("display"in e.insurer.last_invoice),1),a("div",null,"Debug - has date: "+l("date"in e.insurer.last_invoice),1),a("div",null,"Debug - has timestamp: "+l("timestamp"in e.insurer.last_invoice),1)])):s("",!0)]),r[17]||(r[17]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-green-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})]),a("span",{class:"font-medium text-green-800"},"Datum")],-1)),a("div",nn,[r[16]||(r[16]=a("div",{class:"font-medium text-gray-700"},"Letzte Abrechnung:",-1)),p.insurer.last_invoice?(m(),n("div",sn,l(p.insurer.last_invoice.display||(p.insurer.last_invoice.date?new Date(p.insurer.last_invoice.date).toLocaleDateString("de-DE"):"")),1)):(m(),n("div",on," Keine Abrechnung vorhanden ")),a("div",an,[r[15]||(r[15]=a("div",null,[a("strong",null,"Debug:")],-1)),a("div",null,"last_invoice: "+l(JSON.stringify(p.insurer.last_invoice)),1)])])])])):s("",!0),e.insurer.instructions?(m(),n("div",ln,[r[20]||(r[20]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Anweisungen",-1)),a("div",un,[r[19]||(r[19]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-purple-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),a("span",{class:"font-medium text-purple-800"},"Anweisungen")],-1)),a("p",cn,l(e.insurer.instructions),1)])])):s("",!0),e.insurer.kommentar?(m(),n("div",dn,[r[22]||(r[22]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Kommentar",-1)),a("div",gn,[r[21]||(r[21]=a("div",{class:"flex items-center mb-2"},[a("svg",{class:"w-5 h-5 text-gray-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),a("span",{class:"font-medium text-gray-800"},"Kommentar")],-1)),a("p",mn,l(e.insurer.kommentar),1)])])):s("",!0),a("div",{class:"mt-6 space-y-4"},[a("button",{onClick:y,class:"w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"}," Abrechnung soeben erfolgt ")]),c.value?(m(),n("div",pn,[a("div",vn,[r[24]||(r[24]=a("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"Abrechnungsdatum auswählen",-1)),a("div",fn,[r[23]||(r[23]=a("label",{for:"settlementDate",class:"block text-sm font-medium text-gray-700 mb-2"}," Datum der Abrechnung: ",-1)),v(a("input",{ref_key:"dateInputRef",ref:g,type:"date",id:"settlementDate","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500",onKeyup:r[1]||(r[1]=I(()=>b(),["enter"]))},null,544),[[f,d.value]])]),a("div",hn,[a("button",{type:"button",onClick:x,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"}," Abbrechen "),a("button",{type:"button",onClick:r[2]||(r[2]=()=>b()),class:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!d.value}," Bestätigen ",8,yn)])])])):s("",!0)])]))}},xn=Object.freeze(Object.defineProperty({__proto__:null,default:bn},Symbol.toStringTag,{value:"Module"})),wn={class:"test-date-simulator bg-white rounded-lg border border-gray-200 p-3 shadow-sm"},kn={class:"flex flex-col space-y-2"},Sn={class:"flex items-center space-x-2"},Dn=["disabled"],Cn={class:"text-sm font-medium text-gray-900 flex-1 text-center"},En=["disabled"],In=X({__name:"TestDateSimulator",props:{modelValue:{type:Date,default:()=>new Date}},emits:["update:modelValue"],setup(e,{emit:s}){const o=e,i=s,u=t(o.modelValue),c=r(()=>u.value>new Date("2023-01-01")),d=r(()=>u.value<new Date("2025-12-31")),g=e=>{const t=R(e,"dd.MM.yyyy",{locale:q});return console.log("Formatted date:",t),t},p=()=>{if(c.value){const e=new Date(u.value.getTime()-864e5);console.log("Decreasing date to:",e),u.value=e,i("update:modelValue",e),setTimeout(()=>{u.value=e,i("update:modelValue",e)},0)}},v=()=>{if(d.value){const e=new Date(u.value.getTime()+864e5);console.log("Increasing date to:",e),u.value=e,i("update:modelValue",e),setTimeout(()=>{u.value=e,i("update:modelValue",e)},0)}},f=()=>{const e=new Date;console.log("Resetting to:",e),u.value=e,i("update:modelValue",e),setTimeout(()=>{u.value=e,i("update:modelValue",e)},0)};return y(()=>o.modelValue,e=>{console.log("Model value changed to:",e),u.value=new Date(e.getTime())}),(e,t)=>(m(),n("div",wn,[a("div",kn,[a("div",{class:"flex items-center justify-between"},[t[0]||(t[0]=a("span",{class:"text-xs font-medium text-gray-500 uppercase tracking-wider"},"Test Datum",-1)),a("button",{onClick:f,class:"text-xs text-blue-600 hover:text-blue-800 hover:underline focus:outline-none"}," Heute ")]),a("div",Sn,[a("button",{onClick:p,disabled:!c.value,class:"p-1.5 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed"},t[1]||(t[1]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)]),8,Dn),a("span",Cn,l(g(u.value)),1),a("button",{onClick:v,disabled:!d.value,class:"p-1.5 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1 disabled:opacity-50 disabled:cursor-not-allowed"},t[2]||(t[2]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)]),8,En)])])]))}},[["__scopeId","data-v-4710ef3f"]]),_n={class:"app-container"},An={class:"min-h-screen bg-gray-50"},Mn={class:"container mx-auto px-4"},Bn={class:"flex justify-between items-center py-4"},Vn={key:0,class:"text-xs text-blue-500 font-mono ml-4"},Tn={class:"border-b border-gray-200 -mb-px"},jn={class:"flex space-x-8"},Ln={class:"container mx-auto px-4 py-6"},zn={key:0,class:"fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50"},Nn={class:"text-center"},Pn={class:"text-sm text-gray-500"},Fn={class:"lg:col-span-1 space-y-4"},$n={class:"bg-white rounded-lg shadow overflow-hidden"},On={class:"p-4"},Un={class:"lg:col-span-3"},Hn={class:"bg-white shadow overflow-hidden sm:rounded-md"},Rn={class:"border-b border-gray-200 px-4 py-4 sm:px-6 flex justify-between items-center"},Yn={class:"flex items-center"},Kn={key:0,class:"ml-3 flex items-center"},qn={class:"inline-flex"},Gn={key:0,class:"py-12 flex justify-center"},Jn={key:1},Wn={key:0},Xn={key:1,class:"bg-white shadow rounded-lg p-6"},Zn={class:"flex items-center justify-between px-6 py-5 border-b border-gray-100 bg-gray-50"},Qn={class:"text-lg font-medium text-gray-900"},es={class:"p-6 overflow-y-auto",style:{height:"calc(100vh - 80px)"}},ts={__name:"MainApp",setup(e){d(),B();const c=W(),g=t(""),f=t("main"),h=t(!1),x=t("name"),w=t("all"),k=t("production"),E=t(new Date),I=r(()=>{const e={}.VITE_GIT_BRANCH;return"main"===e||"staging"===e}),_=r(()=>({}.VITE_GIT_BRANCH));y(k,async e=>{console.log(`Data mode changed to: ${e}. Fetching data...`),h.value=!0;try{const t="production"===e?"insurers":"insurers_test";await c.fetchInsurers(t)}catch(t){console.error(`Error fetching data for mode ${e}:`,t)}finally{h.value=!1}},{immediate:!0}),u(()=>{console.log("MainApp component mounted")}),M(()=>{console.log("MainApp component unmounted"),c.setSelectedInsurer(null)});const V=r(()=>c.insurers),T=r(()=>c.selectedInsurer),j=r(()=>c.lastInvoices),L=r(()=>{const e=new Date,t={warning:0,critical:0,total:0,on_time:0};return V.value&&V.value.forEach(r=>{t.total++;const n=Rt(r,e);n>0?n<=5?t.warning++:t.critical++:t.on_time++}),t}),z=()=>!I.value&&E.value?E.value:new Date,N=e=>{switch(e){case"warning":return"Warnung (1-5 Tage überfällig)";case"critical":return"Kritisch (>5 Tage überfällig)";case"on_time":return"Pünktlich";default:return e}},P=()=>{w.value="all",console.log("Status filter cleared")},F=e=>{console.log(`Status clicked: ${e.status}`),w.value===e.status?P():(w.value=e.status,console.log(`Filtering insurers by status: ${e.status}`))},$=()=>{console.log("=== handleClearSelection ==="),c.setSelectedInsurer(null)},O=r(()=>{if(!V.value)return[];const e=z();let t=[...V.value];if(g.value.trim()){const e=g.value.toLowerCase().trim();t=t.filter(t=>t.name.toLowerCase().includes(e)||t.id&&t.id.toLowerCase().includes(e))}return"all"!==w.value&&(t=t.filter(t=>{const r=Rt(t,e);switch(w.value){case"warning":return r>0&&r<=5;case"critical":return r>5;case"on_time":return r<=0;default:return!0}})),t}),U=async e=>{console.log("=== handleSettlementCompleted ==="),console.log("Event received in MainApp.vue:",e),console.log("Event handler is running in MainApp.vue");try{if(!e)throw console.error("No event object received"),new Error("No event object received");const{insurer:t,newDate:r,displayDate:n,last_invoice:s}=e;if(!t)throw new Error("No insurer data in event");if(console.log("Processing settlement for insurer:",t.id||t.name),console.log("Processing insurer data:",JSON.stringify(t,null,2)),console.log("New date object:",r),console.log("Last invoice from event:",JSON.stringify(s,null,2)),!(r instanceof Date)||isNaN(r.getTime()))return void console.error("Invalid date provided:",r);const o=r.toISOString().split("T")[0],a=s||{display:n,timestamp:r.getTime(),date:o};console.log("Using last_invoice object:",JSON.stringify(a,null,2));const{saveInvoice:l}=await le(()=>import("./firebaseInvoices-Drumxco1.js"),["assets/firebaseInvoices-Drumxco1.js","assets/vendor-firebase-BiA2yxOo.js","assets/vendor-BfUC8jLb.js","assets/vendor-vue-aTg9__mV.js"]);console.log(`Current environment: ${k.value}`),await l(t.id,t.name,a,k.value),console.log("New invoice saved to Firebase"),await c.updateInsurerLastInvoice(t.id,a),console.log("Local insurer data updated in Pinia store"),await nextTick(),console.log("UI updated via nextTick");const i={id:`invoice-${Date.now()}`,date:r,display:a.display||n,timestamp:a.timestamp||r.getTime(),amount:t.amount||"0.00",status:"Erfolgreich",documentType:"Rechnung"};console.log("Created new invoice entry:",JSON.stringify(i,null,2));const u={...j.value,[t.id]:[i,...(j.value[t.id]||[]).slice(0,4)]};c.setLastInvoices(u),console.log("Updated lastInvoices in store"),console.log("=== Settlement completed successfully ==="),await nextTick()}catch(t){console.error("Error in handleSettlementCompleted:",t)}},H=r(()=>{const e=[];return V.value&&Array.isArray(V.value)?(console.log("Processing insurers for history:",V.value),V.value.forEach(t=>{if(!t||!t.name)return;const r=j.value[t.id]||[];r&&r.length>0&&r.forEach(r=>{e.push({insurerId:t.id,insurerName:t.name,date:r.date?new Date(r.date):null,amount:r.amount,note:r.note,id:r.id})})}),0===e.length?(console.log("No real abrechnungen data, using sample data"),R()):e.sort((e,t)=>e.date?t.date?t.date.getTime()-e.date.getTime():-1:1)):(console.warn("insurersData is not a valid array:",V.value),R())}),R=()=>[{insurerId:"sample-1",insurerName:"Allianz",date:new Date(2025,5,15),amount:"1250.00",documentType:"Rechnung",status:"Erfolgreich",id:"sample-invoice-1"},{insurerId:"sample-2",insurerName:"AXA",date:new Date(2025,5,10),amount:"980.50",documentType:"Gutschrift",status:"Erfolgreich",id:"sample-invoice-2"},{insurerId:"sample-3",insurerName:"Generali",date:new Date(2025,4,28),amount:"1560.75",documentType:"Rechnung",status:"Ausstehend",id:"sample-invoice-3"},{insurerId:"sample-4",insurerName:"HUK-Coburg",date:new Date(2025,4,20),amount:"2100.00",documentType:"Rechnung",status:"Fehlgeschlagen",id:"sample-invoice-4"},{insurerId:"sample-5",insurerName:"ERGO",date:new Date(2025,4,5),amount:"750.25",documentType:"Gutschrift",status:"Erfolgreich",id:"sample-invoice-5"}];return(e,t)=>(m(),n("div",_n,[a("div",An,[a("header",{class:i(["bg-white shadow-sm sticky top-0 z-10",{"bg-yellow-100":!I.value}])},[a("div",Mn,[a("div",Bn,[t[10]||(t[10]=a("h1",{class:"text-xl font-semibold text-gray-900"},"Versicherungsübersicht",-1)),I.value?s("",!0):(m(),n("div",Vn,"Branch: "+l(_.value),1))]),a("div",Tn,[a("nav",jn,[a("button",{onClick:t[0]||(t[0]=e=>f.value="main"),class:i(["py-4 px-1 border-b-2 font-medium text-sm focus:outline-none","main"===f.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Übersicht ",2),a("button",{onClick:t[1]||(t[1]=e=>f.value="history"),class:i(["py-4 px-1 border-b-2 font-medium text-sm focus:outline-none","history"===f.value?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])}," Abrechnungen ",2)])])])],2),a("div",Ln,[h.value?(m(),n("div",zn,[a("div",Nn,[t[11]||(t[11]=a("svg",{class:"animate-spin h-10 w-10 text-blue-600 mx-auto mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),t[12]||(t[12]=a("p",{class:"text-lg font-medium text-gray-700"},"Daten werden geladen...",-1)),a("p",Pn,l("production"===k.value?"Produktionsumgebung":"Testumgebung"),1)])])):s("",!0),"main"===f.value?(m(),n("div",{key:1,class:i(["grid grid-cols-1 lg:grid-cols-4 gap-6",{"filter blur-sm":T.value}])},[a("div",Fn,[S(Nt,{statusCounts:L.value,activeStatus:w.value,onStatusClicked:F},null,8,["statusCounts","activeStatus"]),a("div",$n,[a("div",On,[S(Ot,{modelValue:g.value,"onUpdate:modelValue":t[2]||(t[2]=e=>g.value=e),placeholder:"Versicherer suchen..."},null,8,["modelValue"])])]),I.value?s("",!0):(m(),o(In,{key:0,modelValue:E.value,"onUpdate:modelValue":t[3]||(t[3]=e=>E.value=e)},null,8,["modelValue"]))]),a("div",Un,[a("div",Hn,[a("div",Rn,[a("div",Yn,[t[15]||(t[15]=a("h2",{class:"text-lg font-medium text-gray-900"},"Versicherer",-1)),"all"!==w.value?(m(),n("div",Kn,[t[14]||(t[14]=a("span",{class:"text-sm text-gray-500"},"Filter:",-1)),a("span",{class:i(["ml-1 px-2 py-1 text-xs rounded-full",{"bg-yellow-100 text-yellow-800":"warning"===w.value,"bg-red-100 text-red-800":"critical"===w.value,"bg-green-100 text-green-800":"on_time"===w.value}])},l(N(w.value)),3),a("button",{onClick:P,class:"ml-1 text-gray-400 hover:text-gray-600",title:"Filter zurücksetzen"},t[13]||(t[13]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])):s("",!0)]),a("div",qn,[v(a("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>x.value=e),class:"form-select rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50"},t[16]||(t[16]=[a("option",{value:"name"},"Name",-1),a("option",{value:"date"},"Letztes Abrechnungsdatum",-1),a("option",{value:"overdue"},"Tage überfällig",-1)]),512),[[b,x.value]])])]),h.value?(m(),n("div",Gn,t[17]||(t[17]=[A('<div class="animate-pulse flex space-x-4 items-center"><div class="h-3 w-3 bg-blue-400 rounded-full"></div><div class="h-3 w-3 bg-blue-400 rounded-full"></div><div class="h-3 w-3 bg-blue-400 rounded-full"></div><div class="text-sm text-gray-500">Laden...</div></div>',1)]))):(m(),n("div",Jn,[S(Ar,{insurers:O.value,sortBy:x.value,lastInvoices:j.value,currentDate:z(),selectedInsurer:T.value,onSelectInsurer:t[5]||(t[5]=e=>{return t=e,console.log("=== handleInsurerSelection ==="),console.log("Selected insurer:",t),void c.setSelectedInsurer(t);var t}),onClearSelection:t[6]||(t[6]=e=>$())},null,8,["insurers","sortBy","lastInvoices","currentDate","selectedInsurer"])]))])])],2)):"history"===f.value?(m(),n("div",{key:2,class:i(["w-full",{"filter blur-sm":T.value}])},[H.value&&H.value.length>0?(m(),n("div",Wn,[S(Vt,{abrechnungen:H.value,"is-production-branch":I.value},null,8,["abrechnungen","is-production-branch"])])):(m(),n("div",Xn,t[18]||(t[18]=[a("p",{class:"text-gray-500 text-center"},"Keine Abrechnungen verfügbar.",-1)])))],2)):s("",!0),S(C,{name:"fade"},{default:D(()=>[T.value?(m(),n("div",{key:0,onClick:t[7]||(t[7]=e=>$()),class:"fixed inset-0 bg-black bg-opacity-50 z-20 transition-opacity duration-300"})):s("",!0)]),_:1}),S(C,{name:"slide-in-right"},{default:D(()=>[T.value?(m(),n("div",{key:0,class:"fixed inset-y-0 right-0 w-full max-w-2xl bg-white shadow-2xl z-30 transform transition-transform duration-300 ease-in-out border-l border-gray-100",onClick:t[9]||(t[9]=p(()=>{},["stop"]))},[a("div",Zn,[a("h2",Qn,l(T.value.name),1),a("button",{onClick:t[8]||(t[8]=e=>$()),class:"text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full"},t[19]||(t[19]=[a("svg",{class:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[a("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),a("div",es,[S(bn,{insurer:T.value,"last-invoices":j.value[T.value.id]||[],"current-date":z(),"is-production-branch":I.value,onSettlementCompleted:U},null,8,["insurer","last-invoices","current-date","is-production-branch"])])])):s("",!0)]),_:1})])])]))}},rs=V({history:T({}.VITE_APP_BASE_URL||"/"),routes:[{path:"/login",name:"login",component:fe,meta:{requiresAuth:!1}},{path:"/",name:"app",component:ts,meta:{requiresAuth:!0}},{path:"/insurer/:name",name:"insurer-detail",component:()=>le(()=>Promise.resolve().then(()=>xn),void 0),meta:{requiresAuth:!0}}]});rs.beforeEach((e,t,r)=>{const n=e.matched.some(e=>e.meta.requiresAuth),s=localStorage.getItem("authToken");n&&!s?r("/login"):"/login"===e.path&&s?r("/"):r()});console.log("Starting app initialization..."),console.log("Environment:","production");(async()=>{console.log("Initializing application...");try{console.log("Creating Pinia store...");const t=j();console.log("Creating Vue app instance...");const r=L({render:()=>z(oe)});console.log("Applying plugins..."),r.use(t),r.config.errorHandler=(e,t,r)=>{console.error("Vue Error Handler:",{error:e,component:t?.$options?.name||"Unknown",info:r,url:window.location.href});const n=document.createElement("div");n.className="global-error",n.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        background: #fee2e2;\n        color: #b91c1c;\n        padding: 1rem;\n        z-index: 9999;\n        font-family: system-ui, -apple-system, sans-serif;\n      ",n.innerHTML=`\n        <div style="max-width: 1200px; margin: 0 auto;">\n          <h3 style="margin: 0 0 0.5rem 0;">An error occurred</h3>\n          <p style="margin: 0 0 0.5rem 0; font-size: 0.9rem;">${e.message||"Unknown error"}</p>\n          <div style="display: flex; gap: 0.5rem;">\n            <button onclick="this.parentNode.parentNode.remove()" style="padding: 0.25rem 0.75rem; background: #fca5a5; border: none; border-radius: 4px; cursor: pointer;">\n              Dismiss\n            </button>\n            <button onclick="window.location.reload()" style="padding: 0.25rem 0.75rem; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer;">\n              Reload Page\n            </button>\n          </div>\n        </div>\n      `,document.body.prepend(n)},window.addEventListener("unhandledrejection",e=>{console.error("Unhandled Promise Rejection:",e.reason)}),window.onerror=function(e,t,r,n,s){return console.error("Global Error:",{message:e,source:t,lineno:r,colno:n,error:s}),!0},console.log("Applying router..."),r.use(rs);try{console.log("Waiting for router to be ready..."),await rs.isReady(),console.log("Mounting app..."),r.mount("#app"),console.log("App mounted successfully"),window.dispatchEvent(new Event("app-mounted"))}catch(e){console.error("Router initialization failed:",e),console.log("Attempting fallback mount without router..."),r.mount("#app"),window.dispatchEvent(new Event("app-mounted"))}}catch(t){console.error("Critical error during app initialization:",t);L({render:()=>z("div",{class:"p-4 text-red-600"},[z("h1","Application Error"),z("p","A critical error occurred while loading the application."),z("pre",t.toString())])}).mount("#app")}})();export{J as d};
